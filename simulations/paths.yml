version: "3"
name: "paths"

# All clients are in the same group
# Nodes are connected as such:
#
#    b - c - d
#   /  \   /  \
#  a --- e --- h
#   \         /
#    f ----- g
#

services:
  a:
    extends: { file: common.yml, service: drone }
    networks: [ ab, ae, af ]
    environment: [ TCDICN_ID=my_sensor ]
  b:
    extends: { file: common.yml, service: node }
    networks: [ ab, bc, be ]
    environment: [ TCDICN_ID=my_sensor ]
  c:
    extends: { file: common.yml, service: node }
    networks: [ bc, cd ]
    environment: [ TCDICN_ID=my_sensor ]
  d:
    extends: { file: common.yml, service: node }
    networks: [ cd, de, dh ]
    environment: [ TCDICN_ID=my_sensor ]
  e:
    extends: { file: common.yml, service: node }
    networks: [ ae, be, de, eh ]
    environment: [ TCDICN_ID=my_sensor ]
  f:
    extends: { file: common.yml, service: node }
    networks: [ af, fg ]
    environment: [ TCDICN_ID=my_sensor ]
  g:
    extends: { file: common.yml, service: node }
    networks: [ fg, gh ]
    environment: [ TCDICN_ID=my_sensor ]
  h:
    extends: { file: common.yml, service: controller }
    networks: [ dh, eh, gh ]
    environment: [ TCDICN_ID=my_sensor ]

networks:
  ab: { ipam: { config: [ subnet: 172.3.1.0/24 ] } }
  ae: { ipam: { config: [ subnet: 172.3.2.0/24 ] } }
  af: { ipam: { config: [ subnet: 172.3.3.0/24 ] } }
  bc: { ipam: { config: [ subnet: 172.3.4.0/24 ] } }
  be: { ipam: { config: [ subnet: 172.3.5.0/24 ] } }
  cd: { ipam: { config: [ subnet: 172.3.6.0/24 ] } }
  de: { ipam: { config: [ subnet: 172.3.7.0/24 ] } }
  dh: { ipam: { config: [ subnet: 172.3.8.0/24 ] } }
  eh: { ipam: { config: [ subnet: 172.3.9.0/24 ] } }
  fg: { ipam: { config: [ subnet: 172.3.10.0/24 ] } }
  gh: { ipam: { config: [ subnet: 172.3.11.0/24 ] } }
